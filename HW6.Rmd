---
title: "Data Science HW #6"
author: "Nathalie Fadel"
date: "11/19/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(purrr)
library(modelr)
```

#Problem 1  

##Data import and cleaning
```{r}
murder_data = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")

murder_data = murder_data %>%
  unite("city_state", c("city", "state"), sep = ",", remove = TRUE)

murder_data = murder_data %>%
  mutate(solved_case = ifelse(disposition == c("Closed by arrest"), 1, 0)) %>%
  mutate(victim_race = ifelse(victim_race != "White", "Non-White", "White")) %>%
  mutate(victim_race = forcats::fct_relevel(victim_race, "White", "Non-White")) %>%
  mutate(victim_age = as.numeric(victim_age)) %>%
  mutate(victim_sex = forcats::fct_relevel(victim_sex, "Male", "Female", "Unknown"))

murder_data = murder_data %>%
  filter(!(city_state %in% c("Dallas,TX", "Phoenix,AZ", "Kansas City,MO", "Tulsa,AL")))  
```

##Logistic Regression
```{r, fig.height = 6}
baltimore_df = murder_data %>%
  filter(city_state %in% c("Baltimore,MD")) %>%
  select(solved_case, victim_age, victim_race, victim_sex)
  
baltimore_logistic = 
  baltimore_df %>% 
  glm(solved_case ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 

broom::tidy(baltimore_logistic) %>%
filter(term == "victim_raceNon-White") %>%
  mutate(OR = exp(estimate), 
         UB = exp(estimate+1.96 * std.error), 
         LB = exp(estimate-1.96 * std.error)) %>%
  select(OR, LB, UB) %>% 
  knitr::kable(digits = 3)

city_logistic =
  murder_data %>%
  group_by(city_state) %>%
  nest() %>%
   mutate(solved_logit = map(data, ~glm(solved_case ~ victim_race + victim_sex + victim_age, data = . , family = binomial)),
    solved_logit = map(solved_logit, broom::tidy)) %>%
  select(-data) %>%
  unnest() %>%
  filter(term == "victim_raceNon-White") %>%
  mutate(OR = exp(estimate), 
         UB = exp(estimate+1.96 * std.error), 
         LB = exp(estimate-1.96 * std.error),
         city_state = forcats::fct_reorder(city_state, estimate)) %>%
  select(city_state, OR, LB, UB) %>%
  ggplot(aes(x = city_state, y = OR)) +
  geom_point() +
  geom_errorbar(aes(ymin = LB, ymax = UB)) +
  coord_flip() +
  labs(x = "Location")
  
city_logistic
```

#Problem 2  

##Data Import and cleaning  
```{r}
birth_data = read_csv("data/birthweight.csv") %>%
  janitor::clean_names() %>%
  mutate(babysex = as.factor(babysex),
         frace = as.factor(frace),
         malform = as.factor(malform),
         mrace = as.factor(mrace))

missing_values = sum(is.na(birth_data))
missing_values
```
Missing values = 0, therefore, there are no missing values in the dataset.  

##My linear model  
```{r, warning = FALSE}
set.seed(10)

cv_birthw = crossv_mc(birth_data, 100)

cv_birthw = cv_birthw %>%
mutate(mat_model = map(train, ~lm(bwt ~ fincome + momage + mrace + parity + pnumlbw + pnumsga + ppbmi + smoken + wtgain, data = .x))) %>%
  mutate(mat_rmse = map2_dbl(mat_model, test, ~rmse(model = .x, data = .y)))

cv_birthw %>% 
  select(starts_with("mat_rmse")) %>% 
  gather(key = model, value = rmse) %>% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_violin()

mat_model = birth_data %>%
  lm(bwt ~ fincome + momage + mrace + parity + pnumlbw + pnumsga + ppbmi + smoken + wtgain, data = .)

birth_data %>% 
  add_predictions(mat_model) %>% 
  add_residuals(mat_model) %>% 
  ggplot(aes(x = pred, y = resid)) + 
  geom_point() + 
  geom_smooth(se = FALSE) + 
  labs(x = "Predicted value", y = "Residual")
```

My model contains maternal health-related predictors of baby's birth weight, both clinical and demographic. These are all things that can have a certain amount of intervention, whereas predictors such as the baby's height, head circumference, and physical deformity aren't able to be changed. Additionally, there is most likely some collinearity between these variables, so if more than one of baby's height, head circumference, and physical deformity are used in the model, it would bias the model and create a false association.

##Comparing to other models  
```{r}


```
